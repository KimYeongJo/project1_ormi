<!DOCTYPE html>
<html lang="ko">
    <head>
        <meta charset="UTF-8" />
        <meta http-equiv="X-UA-Compatible" content="IE=edge" />
        <meta name="viewport" content="width=device-width, initial-scale=1.0" />
        <title></title>
    </head>
    <body>
        <div>
            <form>
                <label for="grade">학년을 입력해주세요 (ex. 고등학교 3학년)</label><br>
                <input type="text" id="grade" autofocus/><br>
                <label for="semester">학기를 입력해주세요 (ex. 1학기)</label><br>
                <input type="text" id="semester"/><br>
                <label for="subject">과목을 입력해주세요 (ex. 물리)</label><br>
                <input type="text" id="subject"/><br>
                <label for="range">출제범위를 입력해주세요 (ex. 파동, 전자기장)</label><br>
                <input type="text" id="range"/><br>
                <label for="count">풀고 싶은 문제 개수를 적어주세요</label><br>
                <input type="text" id="count"/><br>
                <button type="submit">전송</button>
            </form>
        </div>
        <div id="display"></div>
        <script>
            let $button = document.querySelector('button')
            let $input = document.querySelectorAll('input')
            let $display = document.getElementById('display')
            
            let url = `https://estsoft-openai-api.jejucodingcamp.workers.dev/`

            let inputData = []
            let aiData = []
            let sendData = [{
                "role": "system",
                "content": "assistant는 천재 문제 제작자다."
            }]            

            $button.addEventListener("click", e => {
                e.preventDefault()
                for (i = 0; i < $input.length; i++) {
                    inputData[i] = $input[i].value
                }
                
                $input[2].value = ''
                $input[3].value = ''

                sendData.push({
                    "role": "user",
                    content: `${inputData[0]} ${inputData[1]} ${inputData[2]} ${inputData[3]} 문제를 각 ${inputData[4]}개 만들어줘. 결과는 반드시 "문제1":{"문제", "정답", "해설"} 순이고, json 으로만 해줘.`
                })
                aiAPI()
                sendData.pop()
            })

            function aiAPI() {
                fetch(url, {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                },
                body: JSON.stringify(sendData),
                redirect: "follow",
                })
                .then(res => res.json())
                .then(res => {
                    console.log(res.choices[0].message.content)
                    aiData = JSON.parse(res.choices[0].message.content)
                    console.log(aiData)
                    manageData(aiData)
                })
            }

            function manageData(aiData) {
                for (i in aiData) {
                    let problem = document.createElement("h2");
                    let solve = document.createElement("textarea")
                    let answer = document.createElement("p");
                    let solution = document.createElement("p");
                    let id = aiData[i]
                    
                    problem.textContent = id["문제"];
                    solve.innerText = ''
                    answer.textContent = `정답: ${id["정답"]}`
                    solution.textContent = `해설: ${id["해설"]}`

                    display.appendChild(problem);
                    display.appendChild(solve);
                    display.appendChild(answer);
                    display.appendChild(solution);
                }
            }
        </script>
    </body>
</html>